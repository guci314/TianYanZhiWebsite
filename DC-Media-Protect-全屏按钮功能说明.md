# DC Media Protect - PDF安全全屏查看功能说明

## 🔒 保护功能修复

**DC Media Protect插件现在提供增强的PDF安全查看解决方案：全面防止通过全屏功能绕过文档保护。**

### ⚡ 重要修复

**问题解决：** 之前的全屏按钮存在安全漏洞，用户可以通过新窗口绕过水印和防下载保护。现在已完全修复！

## 功能特性

### 🛡️ 增强安全功能
1. **安全全屏查看**：全屏模式下保持完整的保护措施
2. **双重水印保护**：主页面和全屏窗口都有强化水印
3. **防绕过机制**：无法通过全屏功能绕过任何保护措施
4. **智能保护检测**：自动识别并应用保护参数
5. **强化防护措施**：增强的右键禁用、快捷键拦截和开发者工具检测

### ✨ 核心功能
1. **安全全屏查看**：点击"🔒 安全全屏"按钮在受保护的全屏窗口中查看PDF
2. **PDF.js集成**：使用专业的PDF.js查看器提供最佳查看体验
3. **手势缩放支持**：在全屏窗口中完全支持PDF.js的手势缩放功能
4. **完整水印保护**：全屏模式下保持所有防下载、防复制、版权保护功能
5. **移动端优化**：自适应布局和移动端备用链接

### 🔧 技术特点
1. **安全设计**：全屏窗口使用受保护的自定义页面
2. **强化保护**：多层水印、禁用下载/打印按钮、强化防复制
3. **跨浏览器兼容**：支持所有主流浏览器
4. **响应式设计**：桌面端和移动端自动适配
5. **性能优化**：保持高性能的同时提供完整保护

## 使用方法

### 基本语法
```
[dc_ppt src="PDF文件地址" width="宽度" height="高度"]
```

### 使用示例
```
[dc_ppt src="/wp-content/uploads/2025/05/document.pdf" width="800" height="600"]
```

### 操作说明
1. **点击安全全屏按钮**：绿色的"🔒 安全全屏"按钮将PDF在受保护的全屏窗口中打开
2. **手势操作**：在全屏窗口中可以使用触摸手势缩放PDF
3. **鼠标操作**：使用鼠标滚轮进行缩放
4. **PDF.js功能**：全屏窗口中可使用PDF.js的所有功能（搜索、页面导航等）
5. **移动端备用**：移动设备显示"📄 直接打开PDF"备用链接
6. **安全退出**：点击左上角"✕ 退出全屏"按钮安全关闭窗口

## 安全保护措施

### 🛡️ 主页面保护
- 多层水印叠加
- 右键菜单禁用
- 快捷键拦截（Ctrl+S、Ctrl+P、Ctrl+A等）
- 拖拽保护
- 选择保护

### 🔒 全屏模式保护
- **强化水印覆盖**：红色醒目的版权水印
- **全键盘拦截**：禁用所有复制、保存、打印快捷键
- **开发者工具检测**：检测并警告开发者工具的使用
- **右键保护**：完全禁用右键菜单并显示警告
- **打印功能禁用**：覆盖浏览器原生打印功能
- **工具栏按钮拦截**：监听并拦截PDF.js的下载/打印按钮

### ⚠️ 防绕过机制
- 受保护的自定义全屏页面
- 参数化保护识别（dcmp_protected=1）
- 水印文本动态传递
- 多重事件拦截
- 控制台版权警告

## 兼容性

### 支持的浏览器
- ✅ Chrome (所有版本)
- ✅ Firefox (所有版本)
- ✅ Safari (所有版本)
- ✅ Edge (所有版本)
- ✅ iOS Safari
- ✅ Android Chrome

### 移动设备支持
- ✅ iOS设备：支持安全全屏查看和手势缩放
- ✅ Android设备：支持安全全屏查看和手势缩放
- ✅ 响应式设计：根据设备自动调整默认尺寸
- ✅ 备用链接：移动端提供直接PDF访问链接

## 文件结构

### 主要文件
- `wp-content/plugins/dc-media-protect/includes/shortcode.php` - 短代码实现（已更新）
- `wp-content/plugins/pdfjs-viewer-shortcode/pdfjs/web/viewer.php` - PDF.js查看器（已增强保护）

### 更新内容
- ✅ 安全全屏查看按钮
- ✅ 强化水印保护层
- ✅ 防绕过机制
- ✅ 增强的移动端优化
- ✅ 强化防下载保护

### 向后兼容
- ✅ 保持原有短代码语法
- ✅ 现有参数继续有效
- ✅ 不影响其他媒体类型（video、img等）

## 界面说明

### 桌面端界面
- **PDF容器**：800x600像素（可自定义）
- **安全全屏按钮**：绿色按钮，带有锁定图标"🔒 安全全屏"
- **水印保护**：右上角显示"🔒 [水印文字]"
- **版权信息**：左下角显示"版权保护 - 禁止下载"

### 全屏模式界面
- **强化水印**：红色背景的醒目水印
- **退出按钮**：左上角红色"✕ 退出全屏"按钮
- **保护提示**：左下角"⚠️ 受保护文档 - 禁止下载"
- **中央水印**：大号透明水印文字
- **背景图案**：斜纹保护背景

### 移动端界面
- **响应式容器**：100%宽度，500像素高度
- **安全全屏按钮**：保持相同的绿色锁定设计
- **直接链接**：左上角绿色"📄 直接打开PDF"备用链接
- **自适应水印**：根据屏幕大小调整

## 安全等级

### 🟢 基础保护（主页面）
- HTML/CSS水印叠加
- JavaScript事件拦截
- 基础快捷键禁用

### 🟡 增强保护（iframe内）
- PDF.js参数控制
- 工具栏按钮禁用
- 沙箱限制

### 🔴 最高保护（全屏模式）
- 自定义受保护页面
- 强化事件拦截
- 开发者工具检测
- 多重水印覆盖
- 版权警告系统

## 总结

DC Media Protect现在提供了一个安全可靠的PDF查看解决方案：

1. **完全安全**：全屏功能无法绕过任何保护措施
2. **用户友好**：保持良好的查看体验
3. **强化保护**：多层次的安全防护机制
4. **设备兼容**：桌面端和移动端都有优化体验
5. **性能优越**：在保护的同时保持高性能

**⚠️ 重要提醒：现在的全屏功能是完全安全的，用户无法通过任何方式绕过PDF文档保护措施！** 