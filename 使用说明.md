# 微信公众号抓取器使用说明

## 📦 安装依赖

### 1. 安装 Python 包

```bash
pip install playwright asyncio
```

### 2. 安装 Playwright 浏览器

```bash
playwright install chromium
```

## 🚀 快速开始

### 使用简化版抓取器（推荐新手）

```bash
python simple_wechat_scraper.py
```

### 使用完整版抓取器

```bash
python wechat_scraper.py
```

## 🔧 功能特点

### 简化版 (simple_wechat_scraper.py)
- ✅ 界面友好，易于调试
- ✅ 非无头模式，可观察浏览器行为
- ✅ 手动处理验证页面
- ✅ 自动截图和保存文本
- ⚠️ 功能相对简单

### 完整版 (wechat_scraper.py)
- ✅ 全自动处理验证
- ✅ 多重反爬虫绕过
- ✅ 多种输出格式 (JSON, TXT, HTML)
- ✅ 重试机制
- ✅ 详细的错误处理
- ⚠️ 配置相对复杂

## 🛡️ 反爬虫处理

根据搜索结果，目标链接 `https://mp.weixin.qq.com/s/5kBJaZenOxfRWMZyoFfppQ` 
显示"环境异常，完成验证后即可继续访问"，脚本已针对此问题设计了解决方案：

### 自动处理机制
1. **模拟真实设备**: 使用 iPhone Safari 用户代理
2. **反检测脚本**: 隐藏自动化特征
3. **验证等待**: 检测到验证页面时自动等待
4. **重试机制**: 失败时自动重试

## 📁 输出文件

### 简化版输出
- `scraped_content.txt` - 抓取的文本内容
- `screenshot.png` - 页面截图

### 完整版输出（保存在 output/ 目录）
- `YYYYMMDD_HHMMSS_文章标题.json` - 完整数据JSON格式
- `YYYYMMDD_HHMMSS_文章标题.txt` - 纯文本格式
- `YYYYMMDD_HHMMSS_文章标题.html` - HTML格式，可在浏览器查看

## 🔍 使用步骤

### 第一次使用建议使用简化版：

1. **运行脚本**
   ```bash
   python simple_wechat_scraper.py
   ```

2. **观察浏览器**
   - 脚本会自动打开浏览器
   - 导航到目标链接

3. **处理验证**
   - 如果出现"环境异常"页面
   - 在浏览器中手动完成验证
   - 在终端按回车继续

4. **查看结果**
   - 检查生成的文件
   - 查看抓取摘要信息

## ⚙️ 自定义配置

### 修改目标URL
编辑脚本中的 `url` 变量：
```python
url = "https://mp.weixin.qq.com/s/你的文章ID"
```

### 调整超时时间
```python
await page.goto(url, timeout=30000)  # 30秒超时
```

### 启用/禁用无头模式
```python
browser = await p.chromium.launch(
    headless=False,  # False=显示浏览器, True=隐藏浏览器
)
```

## 🚨 注意事项

1. **法律合规**: 请确保抓取行为符合相关法律法规
2. **频率控制**: 避免过于频繁的请求
3. **尊重robots.txt**: 遵守网站的爬虫协议
4. **数据使用**: 合理使用抓取的数据

## 🐛 故障排除

### 常见问题

#### 1. 浏览器无法启动
```bash
# 重新安装浏览器
playwright install chromium --force
```

#### 2. 验证页面无法通过
- 尝试手动在浏览器中访问链接
- 更换网络环境
- 等待一段时间后重试

#### 3. 内容抓取为空
- 检查网页是否正常加载
- 增加等待时间
- 检查页面结构是否发生变化

#### 4. 模块导入错误
```bash
# 确保已安装所有依赖
pip install -r requirements.txt
```

## 🔄 更新日志

- **v1.0**: 基础抓取功能
- **v1.1**: 添加反爬虫处理
- **v1.2**: 优化验证页面处理
- **v1.3**: 添加多种输出格式

## 📞 技术支持

如果遇到问题，请检查：
1. Python 版本 >= 3.7
2. 网络连接正常
3. 所有依赖已正确安装

## ⚖️ 免责声明

本工具仅供学习和研究使用，请遵守目标网站的使用条款和相关法律法规。
用户应对使用本工具的行为和后果承担全部责任。 