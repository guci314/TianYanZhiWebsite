# DC Media Protect ç”Ÿäº§ç¯å¢ƒå…¨å±æŒ‰é’®æ— ååº” - è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜æè¿°

æ‚¨åæ˜ DC Media Protectæ’ä»¶åœ¨Dockerå¼€å‘ç¯å¢ƒè¿è¡Œæ­£å¸¸ï¼Œä½†éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨åï¼Œç‚¹å‡»å…¨å±æŒ‰é’®æ²¡æœ‰ååº”ã€‚è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ç¯å¢ƒå·®å¼‚é—®é¢˜ã€‚

## ğŸ“Š é—®é¢˜åˆ†æ

æ ¹æ®æˆ‘å¯¹æ’ä»¶ä»£ç çš„åˆ†æï¼Œå…¨å±æŒ‰é’®çš„å·¥ä½œåŸç†æ˜¯ï¼š

1. **æŒ‰é’®HTML**ï¼šåœ¨çŸ­ä»£ç ä¸­ç”Ÿæˆå…¨å±æŒ‰é’®ï¼ŒåŒ…å« `onclick="dcmpOpenProtectedFullscreen(...)"` 
2. **JavaScriptå‡½æ•°**ï¼š`frontend.js` æ–‡ä»¶ä¸­å®šä¹‰äº† `dcmpOpenProtectedFullscreen` å‡½æ•°
3. **æ‰§è¡Œé€»è¾‘**ï¼šç‚¹å‡»æŒ‰é’® â†’ è°ƒç”¨JSå‡½æ•° â†’ æ£€æµ‹è®¾å¤‡ç±»å‹ â†’ æ¡Œé¢ç«¯å¼¹çª—/ç§»åŠ¨ç«¯è·³è½¬

## ğŸ”§ ç«‹å³è¯Šæ–­æ­¥éª¤

### 1. æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥ï¼ˆæœ€é‡è¦ï¼‰

1. åœ¨æœ‰é—®é¢˜çš„é¡µé¢æŒ‰ **F12** æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾é¡µ
3. ç‚¹å‡»å…¨å±æŒ‰é’®ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
4. è¾“å…¥ `typeof window.dcmpOpenProtectedFullscreen` æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨

**é¢„æœŸç»“æœ**ï¼šåº”è¯¥è¿”å› `"function"`ï¼Œå¦‚æœè¿”å› `"undefined"` è¯´æ˜JavaScriptæœªåŠ è½½

### 2. ç½‘ç»œèµ„æºæ£€æŸ¥

1. åœ¨å¼€å‘è€…å·¥å…·ä¸­åˆ‡æ¢åˆ° **Network** æ ‡ç­¾é¡µ
2. åˆ·æ–°é¡µé¢
3. æŸ¥æ‰¾ `frontend.js` æ–‡ä»¶æ˜¯å¦æˆåŠŸåŠ è½½
4. æ£€æŸ¥çŠ¶æ€ç ï¼ˆåº”è¯¥æ˜¯200ï¼‰

### 3. å¼¹çª—æ‹¦æˆªæ£€æŸ¥

åœ¨åœ°å€æ æŸ¥çœ‹æ˜¯å¦æœ‰å¼¹çª—æ‹¦æˆªå›¾æ ‡ï¼Œå¦‚æœæœ‰è¯·ç‚¹å‡»å…è®¸å¼¹çª—ã€‚

## âš¡ å¿«é€Ÿè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå¼ºåˆ¶æ›´æ–°JavaScriptç‰ˆæœ¬ï¼ˆæ¨èï¼‰

ç¼–è¾‘æ–‡ä»¶ï¼š`wp-content/plugins/dc-media-protect/dc-media-protect.php`

æ‰¾åˆ°ç¬¬33è¡Œå·¦å³ï¼š
```php
wp_enqueue_script('dcmp-frontend', plugins_url('assets/js/frontend.js', __FILE__), ['jquery'], '1.0.7', true);
```

å°†ç‰ˆæœ¬å·æ”¹ä¸ºå½“å‰æ—¶é—´æˆ³ï¼š
```php
wp_enqueue_script('dcmp-frontend', plugins_url('assets/js/frontend.js', __FILE__), ['jquery'], time(), true);
```

è¿™æ ·å¯ä»¥å¼ºåˆ¶æµè§ˆå™¨é‡æ–°åŠ è½½JavaScriptæ–‡ä»¶ã€‚

### æ–¹æ¡ˆ2ï¼šæ¸…é™¤ç¼“å­˜

1. **æµè§ˆå™¨ç¼“å­˜**ï¼šå¼ºåˆ¶åˆ·æ–°é¡µé¢ (Ctrl+F5 æˆ– Cmd+Shift+R)
2. **CDNç¼“å­˜**ï¼šå¦‚æœä½¿ç”¨CDNï¼Œæ¸…é™¤é™æ€èµ„æºç¼“å­˜
3. **WordPressç¼“å­˜**ï¼šå¦‚æœæœ‰ç¼“å­˜æ’ä»¶ï¼Œæ¸…é™¤å…¨éƒ¨ç¼“å­˜
4. **æœåŠ¡å™¨ç¼“å­˜**ï¼šå¦‚æœ‰Nginxç­‰åå‘ä»£ç†ç¼“å­˜ï¼Œä¹Ÿéœ€æ¸…é™¤

### æ–¹æ¡ˆ3ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™

ç¡®ä¿æ’ä»¶æ–‡ä»¶æœ‰æ­£ç¡®çš„æƒé™ï¼š
```bash
chmod -R 755 /path/to/wp-content/plugins/dc-media-protect/
chmod 644 /path/to/wp-content/plugins/dc-media-protect/assets/js/frontend.js
```

### æ–¹æ¡ˆ4ï¼šåº”æ€¥ä¿®å¤ä»£ç 

å¦‚æœä¸Šè¿°æ–¹æ³•éƒ½ä¸è¡Œï¼Œå¯ä»¥åœ¨é¡µé¢å¤´éƒ¨æ·»åŠ ä»¥ä¸‹åº”æ€¥ä»£ç ï¼š

```html
<script>
// åº”æ€¥å…¨å±å‡½æ•°å®šä¹‰
window.dcmpOpenProtectedFullscreen = function(viewerUrl, watermarkText) {
    console.log("ğŸš€ åº”æ€¥ç‰ˆæœ¬ï¼šå¯åŠ¨å®‰å…¨å…¨å±æŸ¥çœ‹å™¨");
    
    var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    if (isMobile) {
        var mobileUrl = viewerUrl + (viewerUrl.indexOf('?') !== -1 ? '&mobile=1' : '?mobile=1');
        window.location.href = mobileUrl;
        return;
    }
    
    var newWindow = window.open("", "_blank", 
        "width=" + screen.width + ",height=" + screen.height + 
        ",scrollbars=yes,resizable=yes,toolbar=no,menubar=no,status=no");
    
    if (newWindow) {
        var protectedHTML = `
<!DOCTYPE html>
<html>
<head>
    <title>å®‰å…¨PDFæŸ¥çœ‹å™¨ - ${watermarkText}</title>
    <meta charset="utf-8">
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #f0f0f0; }
        .protected-container { position: relative; width: 100vw; height: 100vh; }
        .pdf-iframe { width: 100%; height: 100%; border: none; }
        .exit-button { position: absolute; top: 20px; left: 20px; background: #6c757d; color: white; border: none; padding: 12px 16px; border-radius: 6px; cursor: pointer; z-index: 1000001; }
        .watermark-text { position: absolute; top: 20px; right: 20px; background: rgba(255,0,0,0.9); color: white; padding: 12px 20px; border-radius: 8px; z-index: 1000000; }
    </style>
</head>
<body>
    <div class="protected-container">
        <iframe src="${viewerUrl}" class="pdf-iframe"></iframe>
        <button class="exit-button" onclick="window.close()">âœ• é€€å‡ºå…¨å±</button>
        <div class="watermark-text">ğŸ”’ ${watermarkText}</div>
    </div>
</body>
</html>`;
        newWindow.document.write(protectedHTML);
        newWindow.document.close();
    } else {
        alert("âŒ æ— æ³•æ‰“å¼€å®‰å…¨æŸ¥çœ‹å™¨çª—å£\n\nå¯èƒ½è¢«æµè§ˆå™¨çš„å¼¹çª—æ‹¦æˆªå™¨é˜»æ­¢äº†\nè¯·å…è®¸æ­¤ç½‘ç«™çš„å¼¹çª—ï¼Œç„¶åé‡è¯•");
    }
};

console.log('âœ… åº”æ€¥å…¨å±å‡½æ•°å·²å®šä¹‰');
</script>
```

## ğŸ” æ·±åº¦æ’æŸ¥

### æ£€æŸ¥JavaScriptåŠ è½½

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
// æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
console.log('å…¨å±å‡½æ•°æ˜¯å¦å­˜åœ¨:', typeof window.dcmpOpenProtectedFullscreen);

// æ£€æŸ¥jQueryæ˜¯å¦åŠ è½½
console.log('jQueryæ˜¯å¦å­˜åœ¨:', typeof $);

// æ‰‹åŠ¨åŠ è½½å‰ç«¯è„šæœ¬
var script = document.createElement('script');
script.src = '/wp-content/plugins/dc-media-protect/assets/js/frontend.js?v=' + Date.now();
script.onload = function() { console.log('âœ… è„šæœ¬åŠ è½½æˆåŠŸ'); };
script.onerror = function() { console.log('âŒ è„šæœ¬åŠ è½½å¤±è´¥'); };
document.head.appendChild(script);
```

### æ£€æŸ¥æœåŠ¡å™¨é…ç½®

å¯èƒ½çš„æœåŠ¡å™¨ç«¯é—®é¢˜ï¼š
1. **JavaScriptå‹ç¼©æ’ä»¶**ï¼šæŸäº›ä¼˜åŒ–æ’ä»¶å¯èƒ½ç ´åäº†JSå‡½æ•°
2. **å†…å®¹å®‰å…¨ç­–ç•¥(CSP)**ï¼šè¿‡äºä¸¥æ ¼çš„CSPå¯èƒ½é˜»æ­¢å†…è”JavaScript
3. **mod_pagespeed**ï¼šApacheçš„é¡µé¢ä¼˜åŒ–æ¨¡å—å¯èƒ½å½±å“JSåŠ è½½
4. **Cloudflare**ï¼šå¦‚æœä½¿ç”¨Cloudflareï¼Œæ£€æŸ¥å…¶ä¼˜åŒ–è®¾ç½®

### æ£€æŸ¥æ’ä»¶å†²çª

ä¸´æ—¶åœç”¨ä»¥ä¸‹ç±»å‹çš„æ’ä»¶æ¥æ’æŸ¥å†²çªï¼š
- ç¼“å­˜æ’ä»¶
- JavaScriptä¼˜åŒ–æ’ä»¶
- å®‰å…¨æ’ä»¶
- CDNæ’ä»¶

## ğŸ“ è·å–æ”¯æŒ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æ”¶é›†ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯æˆªå›¾**
2. **ç½‘ç»œæ ‡ç­¾é¡µä¸­çš„èµ„æºåŠ è½½æƒ…å†µ**
3. **æœåŠ¡å™¨ç¯å¢ƒä¿¡æ¯**ï¼šPHPç‰ˆæœ¬ã€WordPressç‰ˆæœ¬ã€WebæœåŠ¡å™¨ç±»å‹
4. **æ’ä»¶åˆ—è¡¨**ï¼šç‰¹åˆ«æ˜¯ç¼“å­˜å’Œä¼˜åŒ–ç›¸å…³æ’ä»¶

## âœ… éªŒè¯ä¿®å¤

ä¿®å¤åï¼ŒéªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š
1. ç‚¹å‡»å…¨å±æŒ‰é’®æœ‰ååº”
2. æ¡Œé¢ç«¯èƒ½æ­£å¸¸å¼¹å‡ºä¿æŠ¤çª—å£
3. ç§»åŠ¨ç«¯èƒ½æ­£å¸¸è·³è½¬
4. æ§åˆ¶å°æ²¡æœ‰é”™è¯¯ä¿¡æ¯

æ ¹æ®æ‚¨çš„æè¿°ï¼Œæœ€å¯èƒ½çš„åŸå› æ˜¯JavaScriptæ–‡ä»¶ç¼“å­˜é—®é¢˜ï¼Œå»ºè®®é¦–å…ˆå°è¯•**æ–¹æ¡ˆ1ï¼ˆæ›´æ–°ç‰ˆæœ¬å·ï¼‰**ï¼Œè¿™é€šå¸¸èƒ½è§£å†³90%çš„ç±»ä¼¼é—®é¢˜ã€‚ 